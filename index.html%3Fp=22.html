<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="Content-Language" content="en-gb" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	<meta name="keywords" content="" />
	<title>  Ajax Spy | jQuery for Designers - Tutorials and screencasts</title>
	<link rel="stylesheet" type="text/css" href="wp-content/themes/j4d/static/css/all.min.css" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed/rss/index.html" />
	<link rel="alternate" type="text/xml" title="RSS .92" href="feed/rss/index.html" />
	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="feed/atom/index.html" />

	<link rel="pingback" href="xmlrpc.php" />
		<link rel='archives' title='June 2011' href='2011/06/index.html' />
	<link rel='archives' title='February 2011' href='2011/02/index.html' />
	<link rel='archives' title='August 2010' href='2010/08/index.html' />
	<link rel='archives' title='July 2010' href='2010/07/index.html' />
	<link rel='archives' title='April 2010' href='2010/04/index.html' />
	<link rel='archives' title='March 2010' href='2010/03/index.html' />
	<link rel='archives' title='January 2010' href='2010/01/index.html' />
	<link rel='archives' title='October 2009' href='2009/10/index.html' />
	<link rel='archives' title='September 2009' href='2009/09/index.html' />
	<link rel='archives' title='August 2009' href='2009/08/index.html' />
	<link rel='archives' title='July 2009' href='2009/07/index.html' />
	<link rel='archives' title='June 2009' href='2009/06/index.html' />
	<link rel='archives' title='April 2009' href='2009/04/index.html' />
	<link rel='archives' title='March 2009' href='2009/03/index.html' />
	<link rel='archives' title='February 2009' href='2009/02/index.html' />
	<link rel='archives' title='January 2009' href='2009/01/index.html' />
	<link rel='archives' title='December 2008' href='2008/12/index.html' />
	<link rel='archives' title='October 2008' href='2008/10/index.html' />
	<link rel='archives' title='August 2008' href='2008/08/index.html' />
	<link rel='archives' title='July 2008' href='2008/07/index.html' />
	<link rel='archives' title='June 2008' href='2008/06/index.html' />
	<link rel='archives' title='May 2008' href='2008/05/index.html' />
	<link rel='archives' title='April 2008' href='2008/04/index.html' />
	<link rel='archives' title='March 2008' href='2008/03/index.html' />
	<link rel='archives' title='February 2008' href='2008/02/index.html' />
	<link rel='archives' title='January 2008' href='2008/01/index.html' />
	<link rel='archives' title='December 2007' href='2007/12/index.html' />
<link rel="alternate" type="application/rss+xml" title="jQuery for Designers &raquo; Ajax Spy Comments Feed" href="ajax-spy/feed/index.html" />
<link rel='stylesheet' id='msw_wpfm_scan-css'  href='wp-content/plugins/wordpress-file-monitor/wordpress-file-monitor.php%3Fver=scan.html' type='text/css' media='all' />
<script type='text/javascript' src='http://jqueryfordesigners.com/wp-includes/js/jquery/jquery.js?ver=1.7.1'></script>
<script type='text/javascript' src='wp-content/plugins/wp-ajax-edit-comments/js-includes/wp-ajax-edit-comments.js.php%3Fver=1.1.html'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://jqueryfordesigners.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Play School: Easy Ajax &#8211; load' href='index.html%3Fp=21.html' />
<link rel='next' title='The Book and The Redesign' href='index.html%3Fp=23.html' />
<meta name="generator" content="WordPress 3.3.1" />
<link rel='canonical' href='index.html%3Fp=22.html' />
<link rel='shortlink' href='index.html%3Fp=22.html' />
<link type="text/css" rel="stylesheet" href="wp-content/plugins/wp-ajax-edit-comments/css/editComments.css" />
</head>
<body id="articlePage">


	<!-- BEGIN header -->
	<div id="topstrap">
		<ul>
      <!-- <li class="new"><strong>New!</strong> <a href="http://full-frontal.org">Full Frontal - the JavaScript conference</a></li> -->
			<li class="subscribe">Subscribe to our <a class="feed" href="feed/rss/index.html">Articles</a> <a class="podcast" href="http://phobos.apple.com/WebObjects/MZStore.woa/wa/viewPodcast?id=281057468">Podcast</a></li>
		</ul>
	</div>
	
	<div id="header" class="clearFix">
	
		<div class="minWidth">	
			<h1><a href="index.html"><span>jQuery for Designers</span></a></h1>
			
			<ul id="filter">
				<li>Filter by</li>
				<!-- <li><a href="/">All</a></li> -->
				<li><a href="tag/easy/index.html">Easy</a></li>
				<li><a href="tag/medium/index.html">Medium</a></li>
				<li><a href="tag/hard/index.html">Hard</a></li>
				<li id="searchLink"><a href="index.html%3Fp=22.html#searchForm">Search</a></li>
			</ul>
			
		</div>	
	</div>
	<!-- END header -->
	
	<!-- BEGIN titleHolder -->
	<div id="titleHolder" class="clearFix">
		<div class="titleHolderInner">
		<div id="scrollButtons">
			<div class="minWidth clearFix">
	
        <ul class="clearFix" id="articleStrip">
      <li class="selected"><a title="Ajax Spy" href="index.html%3Fp=22.html"><img alt="Ajax Spy" src="images/video/ajax-spy-thumb.jpg" /></a><em class="selected">Selected</em></li>
<li><a title="Play School: Easy Ajax &#8211; load" href="index.html%3Fp=21.html"><img alt="Play School: Easy Ajax &#8211; load" src="images/video/api-load-thumb.jpg" /></a></li>
<li><a title="API: Filter &#038; Find" href="index.html%3Fp=20.html"><img alt="API: Filter &#038; Find" src="images/video/api-filter-find-thumb.jpg" /></a></li>
<li><a title="Simple jQuery Spy Effect" href="index.html%3Fp=19.html"><img alt="Simple jQuery Spy Effect" src="images/video/simple-spy-thumb.jpg" /></a></li>
<li><a title="Fun with Overflows" href="index.html%3Fp=18.html"><img alt="Fun with Overflows" src="images/video/overflows-thumb.jpg" /></a></li>
<li><a title="Two New Series" href="index.html%3Fp=17.html"><img alt="Two New Series" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Animation Jump &#8211; quick tip" href="animation-jump-quick-tip.1.html"><img alt="Animation Jump &#8211; quick tip" src="images/video/animation-jump-thumb.gif" /></a></li>
<li><a title="Image Fade Revisited" href="image-fade-revisited.1.html"><img alt="Image Fade Revisited" src="images/video/image-fade-revisited-thumb.gif" /></a></li>
<li><a title="Coda Slider Effect" href="coda-slider-effect.1.html"><img alt="Coda Slider Effect" src="images/video/coda-slider-thumb.gif" /></a></li>
<li><a title="Help make jQuery for Designers better" href="index.html%3Fp=13.html"><img alt="Help make jQuery for Designers better" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Image Cross Fade Transition" href="index.html%3Fp=12.html"><img alt="Image Cross Fade Transition" src="images/video/image-fade-thumb.gif" /></a></li>
<li><a title="Coda Popup Bubbles" href="coda-popup-bubbles.1.html"><img alt="Coda Popup Bubbles" src="images/video/coda-bubbles-thumb.gif" /></a></li>
<li><a title="Slider Gallery" href="slider-gallery.1.html"><img alt="Slider Gallery" src="images/video/slider-gallery-thumb.gif" /></a></li>
<li><a title="Image Loading" href="index.html%3Fp=9.html"><img alt="Image Loading" src="images/video/image-loading-thumb.gif" /></a></li>
<li><a title="jQuery Tabs" href="index.html%3Fp=8.html"><img alt="jQuery Tabs" src="images/video/tabs-thumb.gif" /></a></li>
<li><a title="Slide out and drawer effect" href="index.html%3Fp=7.html"><img alt="Slide out and drawer effect" src="images/video/slide-draw-thumb.gif" /></a></li>
<li><a title="Using Ajax to Validate Forms" href="index.html%3Fp=6.html"><img alt="Using Ajax to Validate Forms" src="images/video/validate-thumb.gif" /></a></li>
<li><a title="It&#8217;s all about CSS" href="index.html%3Fp=4.html"><img alt="It&#8217;s all about CSS" src="images/video/css-thumb.gif" /></a></li><li class="new"><a title="Simple use of Event Delegation" href="index.html%3Fp=343.html"><img alt="Simple use of Event Delegation" src="images/video/event-delegation-thumb.gif" /><em>New</em></a></li>
<li><a title="Populate Select Boxes" href="index.html%3Fp=328.html"><img alt="Populate Select Boxes" src="images/video/select-boxes-thumb.gif" /></a></li>
<li><a title="Scroll Linked Navigation" href="index.html%3Fp=309.html"><img alt="Scroll Linked Navigation" src="images/video/scroll-link-nav_thumb.gif" /></a></li>
<li><a title="Debugging Tools" href="index.html%3Fp=290.html"><img alt="Debugging Tools" src="images/video/debuggers_thumb.gif" /></a></li>
<li><a title="Enabling the Back Button" href="index.html%3Fp=252.html"><img alt="Enabling the Back Button" src="http://static.jqueryfordesigners.com/images/video/bbq_thumb.gif" /></a></li>
<li><a title="J4D update: My Book, Other Books, Workshops and talks" href="index.html%3Fp=247.html"><img alt="J4D update: My Book, Other Books, Workshops and talks" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Adding Keyboard Navigation" href="index.html%3Fp=231.html"><img alt="Adding Keyboard Navigation" src="http://static.jqueryfordesigners.com/images/video/keyboard-nav-thumb.jpg" /></a></li>
<li><a title="Fixed Floating Elements" href="index.html%3Fp=214.html"><img alt="Fixed Floating Elements" src="http://static.jqueryfordesigners.com/images/video/fixedfloat-thumb.gif" /></a></li>
<li><a title="Want to learn more about JavaScript? Go Full Frontal!" href="index.html%3Fp=199.html"><img alt="Want to learn more about JavaScript? Go Full Frontal!" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="iPhone-like Sliding Headers" href="index.html%3Fp=190.html"><img alt="iPhone-like Sliding Headers" src="images/video/header-slide-thumb.jpg" /></a></li>
<li><a title="Automatic Infinite Carousel" href="index.html%3Fp=158.html"><img alt="Automatic Infinite Carousel" src="images/video/infinite-auto-thumb.jpg" /></a></li>
<li><a title="Play School: Broken Repeating Animations" href="index.html%3Fp=145.html"><img alt="Play School: Broken Repeating Animations" src="images/video/repeat-effect-thumb.png" /></a></li>
<li><a title="API: queue &#038; dequeue" href="index.html%3Fp=135.html"><img alt="API: queue &#038; dequeue" src="images/video/queue-thumb.gif" /></a></li>
<li><a title="jQuery Infinite Carousel" href="index.html%3Fp=128.html"><img alt="jQuery Infinite Carousel" src="images/video/infinite-thumb.jpg" /></a></li>
<li><a title="jQuery for Designers: In Live Action" href="index.html%3Fp=123.html"><img alt="jQuery for Designers: In Live Action" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Return to normal scheduling" href="index.html%3Fp=120.html"><img alt="Return to normal scheduling" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="SlideDown Animation Jump Revisited" href="index.html%3Fp=89.html"><img alt="SlideDown Animation Jump Revisited" src="images/video/animation-jump2-thumb.gif" /></a></li>
<li><a title="BBC Radio 1 Zoom Tabs" href="index.html%3Fp=81.html"><img alt="BBC Radio 1 Zoom Tabs" src="images/video/radio1-thumb.gif" /></a></li>
<li><a title="API: map &#038; grep" href="index.html%3Fp=75.html"><img alt="API: map &#038; grep" src="images/video/mapgrep-thumb.gif" /></a></li>
<li><a title="SXSW, Server Issues and Redesign" href="index.html%3Fp=54.html"><img alt="SXSW, Server Issues and Redesign" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="jQuery look: Tim Van Damme" href="index.html%3Fp=25.html"><img alt="jQuery look: Tim Van Damme" src="images/video/tvd-thumb.jpg" /></a></li>
<li><a title="How to tell if an element exists" href="index.html%3Fp=24.html"><img alt="How to tell if an element exists" src="images/video/element-exists-thumb.jpg" /></a></li>
<li><a title="The Book and The Redesign" href="index.html%3Fp=23.html"><img alt="The Book and The Redesign" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>        </ul>
      </div>
		
		</div>


		<form id="searchForm" action="index.html">

			<fieldset>
		
				<legend>Search</legend>
				
				<label for="search">Search for</label>
				<input type="text" id="search" placeholder="screencasts &amp; tutorials" name="s" value="" /><input class="button" type="submit" value="Find articles" />
				
			</fieldset>
	
		</form>

		</div>
	</div>
	<!-- END titleHolder -->
	
  <!-- content -->
	<div id="content" class="clearFix">
<div class="header">
		<h1><a href="index.html%3Fp=22.html" rel="bookmark">Ajax Spy</a></h1>

		<p><span>Posted on 30th January 2009 &mdash;</span> Last month I showed you how to create a <a href="index.html%3Fp=19.html">spy effect</a> as seen on the first version of <a href="http://www.quicksnapper.com/" title="QuickSnapper.com">QuickSnapper</a> (though they&#8217;ve since changed their site design with to release the release of Little Snapper).</p>

<p>However I did promise I would demonstrate how to <em>ajaxify</em> the spy.  
</p>
    <ul id="articleNav">
      <li class="prev"><a href="index.html%3Fp=21.html" rel="prev">Earlier: <em>Play School: Easy Ajax &#8211; load</em></a></li>
      <li class="next"><a href="index.html%3Fp=23.html" rel="next">Next: <em>The Book and The Redesign</em></a></li>
    </ul>
</div>
<div id="carbonads-container"><div class="carbonad"><div id="azcarbon"></div><script type="text/javascript">var z = document.createElement("script"); z.type = "text/javascript"; z.async = true; z.src = "http://engine.carbonads.com/z/12976/azcarbon_2_1_0_HORIZ"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(z, s);</script></div></div>
		<ul class="articleNav clearFix">
			<li class="tabTutorial"><a class="tutorial selected" href="index.html%3Fp=22.html"><span>Tutorial</span></a></li>
						<li class="tabDemo"><a class="demo" href="demo/ajax-spy.html"><span>Try Demo</span></a></li>			<li class="tabCode"><a class="code" href="index.html%3Fp=22.html"><span>View Code</span></a></li>
			<li class="tabComments"><a class="comments" href="index.html%3Fp=22.html#allcomments"><em>21</em> <span>Comments</span></a></li>
		</ul>
		
        <div id="article" class="clearFix">
		
			<div class="copy">
            
		    <div id="viewport" class="tutorial">
                <div id="tutorial" class="tab">
    				    				  <div id="videoPreview">
      					<ul>
      						<li><a class="quicktime_video" href="media/ajax-spy.mov"><img alt="QuickTime version" src="wp-content/themes/j4d/static/images/video_quicktime.png"/>Play QuickTime version <span class="download">Right click to download</span></a></li>
      						<li><a class="flash_video" href="media/ajax-spy.flv"><img alt="Flash version" src="wp-content/themes/j4d/static/images/video_flash.png"/>Play Flash version <span class="download">Right click to download</span></a></li>
      					</ul>
      					<img src="images/video/ajax-spy.jpg" alt="Ajax Spy" />
      				</div>
    				
    				            
            
                <p><span id="more-22"></span></p>

<h2>Watch</h2>

<p><a href="media/ajax-spy.mov" class="movie">Watch the jQuery Ajax spy screencast</a> (<a href="video.php%3Ff=ajax-spy.flv.html">Alternative flash version</a>)</p></p>

<p>QuickTime version is approximately 45Mb, flash version is streaming.</p>

<p><a class="source" href="demo/ajax-spy.html">View the demo used in the screencast</a> (<a href="source/ajax-spy-helper.php.html">view the source for the Ajax response</a>)</p></p>

<h2>Breaking down the problem</h2>

<p>My key priority for me, when I&#8217;m writing code that will make Ajax hits, is that where possible, I&#8217;m throttling the number of hits.  By this I mean, I&#8217;m only performing Ajax requests when I absolutely have to.</p>

<p>To achieve this, I&#8217;ll show you in the code where I have created a hidden store of the Ajax response that I use to populate the spy at the preset interval.  This gives the <em>impression</em> of real-time data.  It&#8217;s almost real-time, and since we&#8217;re not working with finance systems or data that <em>absolutely has to be</em> real-time, it&#8217;s acceptable.</p>

<p>The way this is achieve is that we create a hidden store, in our case a <code>ul</code> element, and collecting the Ajax results in the <code>ul</code>.  At the same time, the spy is requesting the latest (i.e. the top) <code>li</code> element in our store.  When the store gets down to the last item, it refills itself.  </p>

<p>It might sound a bit fiddly, but it&#8217;s a very straight forward change to the previous spy.</p>

<p>Here&#8217;s a visualisation of, roughly, what&#8217;s going on:</p>

<p><img class="image" src="images/spy.png" /></p>

<h2>HTML</h2>

<p>As per the original spy, we simply prepare a contain (prefill for those without JS) of latest products:</p>

<pre><code>&lt;ul class=&quot;spy&quot;&gt;
  &lt;li&gt;
    &lt;!-- contents of list item --&gt;
  &lt;/li&gt;
&lt;/ul&gt;</code></pre>

<h2>Server Side</h2>

<p>I&#8217;ve created a dummy server spy which you can <a href="source/ajax-spy-helper.php.html">view the source</a> for.  It&#8217;s nothing special, and for the demo, doesn&#8217;t use a database.  It creates an array of data, randomises it and then loops through 5 of the results returning HTML.</p>

<p>In a production environment, I would expect this to make use of the database, and grab perhaps slightly more items to show in the spy.</p>

<h2>jQuery (changes)</h2>

<p>Since our starting point is the simple spy, I wanted to show where you need to make adjustments to ajaxify the script.</p>

<p>You may want to download the <a href="demo/simple-spy.html">original simple spy</a>.</p>

<h3>Creating the Store</h3>

<p>The first job is create the &#8216;caching&#8217; store that will hold the Ajax results, and will refill itself when it&#8217;s almost empty.</p>

<p>With in the plugin code (but before <code>return this.each()</code>) we create a new function.</p>

<p>It needs to achieve the following tasks:</p>

<ol>
<li>Return the lastest/top item from the store.</li>
<li>Remove that top item from the store.</li>
<li>If we&#8217;re returning the last item from the store, refill via an Ajax hit</li>
</ol>

<pre><code>function getSpyItem($source) {
  // find all the li direct descendants in the store ($source is a ul)
  var $items = $source.find('&gt; li');
  
  // if we only have 1 left, we need to do an ajax hit to get more
  if ($items.length == 1) {
    // do an hit to get some more
    // see <a href="index.html%3Fp=21.html">playschool: ajax load</a> for a screencast on .load
    $source.load('ajax-spy-helper.php');
  } else if ($items.length == 0) {
    // if there are none left, then return false and handle it properly.
    return false;
  }
  
  // grab the first item, and remove it from the $source
  return $items.filter(':first').remove();
}</code></pre>

<h3>Changing the Spy Function</h3>

<p>Originally the spy cached a copy of all the <code>li</code> elements and looped round them.  We had a bit of logic to handle tracking whether we reached the end or not.  With the Ajax version we don&#8217;t need any of this code &#8211; since our store should be infinite (since we&#8217;re getting it live from the server).</p>

<p>Where we had this code:</p>

<pre><code>var $insert = $(items[currentItem]).css({ // ...</code></pre>

<p>Which reads the <code>items</code> array, we&#8217;ll change this to use the <code>getSpyItem</code> function:</p>

<pre><code>var $item = getSpyItem($source); // $source is declared early (see below)
  
if ($item != false) { // i.e. there's a result to work with
  var $insert = $item.css({ // ...
}</code></pre>

<p>We will also remove the <code>currentItem</code> logic within the <code>spy</code> function (and remove the declarations too &#8211; i.e. <code>var currentItem</code> since we don&#8217;t need it anymore).</p>

<h3>Initialising the Spy</h3>

<p>Now that our code is nearly ready, we need to make sure we initialise properly.</p>

<p>The tasks we have left are:</p>

<ol>
<li>Create the store, and save it in the <code>$source</code> variable (as used above)</li>
<li>Only show <code>li</code> according to the <code>limit</code>, and move the remainder in to the <code>$source</code> <code>ul</code> element.</li>
</ol>

<p>Within the <code>this.each()</code> initialisation block, we&#8217;ll create our store, at the same time we hide it and append it to the DOM:</p>

<pre><code>var $source = $('&lt;ul /&gt;').hide().appendTo('body');</code></pre>

<p>Then change:</p>

<pre><code>$list.find('> li').filter(':gt(' + (limit - 1) + ')').remove();</code></pre>

<p>To the following, so that the &#8216;left over&#8217; elements are in the store, ready to be grabbed in <code>getSpyItem</code>:</p>

<pre><code>$list.find('> li').filter(':gt(' + (limit - 1) + ')').appendTo($source);</code></pre>

<p><a href="demo/ajax-spy.html">And that&#8217;s it!</a></p>

<h2>And Finally&#8230;</h2>

<p>We can add a mouse over to pause the spy.  It&#8217;s very simple.</p>

<p>In the <code>spy</code> function, we wrap the logic that grabs new items with:</p>

<pre><code>if (running) { // rest of spy code</code></pre>

<p>However, make sure the <code>setTimeout</code> recursive call is <strong>outside</strong> this <code>if</code> statement so that it keeps checking.</p>

<p>Then we bind two custom events to the spy in the initialisation phase of the plugin:</p>

<pre><code>$list.bind('stop', function () {
    running = false;
}).bind('start', function () {
    running = true;
});</code></pre>

<p>And finally, when we attach our plugin, we can trigger the stop and start events when the mouse enters and leaves (note I&#8217;m using enter/leave rather than in/out):</p>

<pre><code>$('ul.spy').simpleSpy().bind('mouseenter', function () {
    $(this).trigger('stop');
}).bind('mouseleave', function () {
    $(this).trigger('start');
});</code></pre>
                <p class="follow">You should follow me on Twitter <a href="http://twitter.com/rem">here</a> <span class="note">I tweet about jQuery amongst the usual tweet-splurges!</span></p>
                
                