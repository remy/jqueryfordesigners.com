<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="Content-Language" content="en-gb" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	<meta name="keywords" content="" />
	<title>  Enabling the Back Button | jQuery for Designers - Tutorials and screencasts</title>
	<link rel="stylesheet" type="text/css" href="wp-content/themes/j4d/static/css/all.min.css" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed/rss/index.html" />
	<link rel="alternate" type="text/xml" title="RSS .92" href="feed/rss/index.html" />
	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="feed/atom/index.html" />

	<link rel="pingback" href="xmlrpc.php" />
		<link rel='archives' title='June 2011' href='2011/06/index.html' />
	<link rel='archives' title='February 2011' href='2011/02/index.html' />
	<link rel='archives' title='August 2010' href='2010/08/index.html' />
	<link rel='archives' title='July 2010' href='2010/07/index.html' />
	<link rel='archives' title='April 2010' href='2010/04/index.html' />
	<link rel='archives' title='March 2010' href='2010/03/index.html' />
	<link rel='archives' title='January 2010' href='2010/01/index.html' />
	<link rel='archives' title='October 2009' href='2009/10/index.html' />
	<link rel='archives' title='September 2009' href='2009/09/index.html' />
	<link rel='archives' title='August 2009' href='2009/08/index.html' />
	<link rel='archives' title='July 2009' href='2009/07/index.html' />
	<link rel='archives' title='June 2009' href='2009/06/index.html' />
	<link rel='archives' title='April 2009' href='2009/04/index.html' />
	<link rel='archives' title='March 2009' href='2009/03/index.html' />
	<link rel='archives' title='February 2009' href='2009/02/index.html' />
	<link rel='archives' title='January 2009' href='2009/01/index.html' />
	<link rel='archives' title='December 2008' href='2008/12/index.html' />
	<link rel='archives' title='October 2008' href='2008/10/index.html' />
	<link rel='archives' title='August 2008' href='2008/08/index.html' />
	<link rel='archives' title='July 2008' href='2008/07/index.html' />
	<link rel='archives' title='June 2008' href='2008/06/index.html' />
	<link rel='archives' title='May 2008' href='2008/05/index.html' />
	<link rel='archives' title='April 2008' href='2008/04/index.html' />
	<link rel='archives' title='March 2008' href='2008/03/index.html' />
	<link rel='archives' title='February 2008' href='2008/02/index.html' />
	<link rel='archives' title='January 2008' href='2008/01/index.html' />
	<link rel='archives' title='December 2007' href='2007/12/index.html' />
<link rel="alternate" type="application/rss+xml" title="jQuery for Designers &raquo; Enabling the Back Button Comments Feed" href="enabling-the-back-button/feed/index.html" />
<link rel='stylesheet' id='msw_wpfm_scan-css'  href='wp-content/plugins/wordpress-file-monitor/wordpress-file-monitor.php%3Fver=scan.html' type='text/css' media='all' />
<script type='text/javascript' src='http://jqueryfordesigners.com/wp-includes/js/jquery/jquery.js?ver=1.7.1'></script>
<script type='text/javascript' src='wp-content/plugins/wp-ajax-edit-comments/js-includes/wp-ajax-edit-comments.js.php%3Fver=1.1.html'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://jqueryfordesigners.com/wp-includes/wlwmanifest.xml" />
<link rel='prev' title='J4D update: My Book, Other Books, Workshops and talks' href='index.html%3Fp=247.html' />
<link rel='next' title='Debugging Tools' href='index.html%3Fp=290.html' />
<meta name="generator" content="WordPress 3.3.1" />
<link rel='canonical' href='index.html%3Fp=252.html' />
<link rel='shortlink' href='index.html%3Fp=252.html' />
<link type="text/css" rel="stylesheet" href="wp-content/plugins/wp-ajax-edit-comments/css/editComments.css" />
</head>
<body id="articlePage">


	<!-- BEGIN header -->
	<div id="topstrap">
		<ul>
      <!-- <li class="new"><strong>New!</strong> <a href="http://full-frontal.org">Full Frontal - the JavaScript conference</a></li> -->
			<li class="subscribe">Subscribe to our <a class="feed" href="feed/rss/index.html">Articles</a> <a class="podcast" href="http://phobos.apple.com/WebObjects/MZStore.woa/wa/viewPodcast?id=281057468">Podcast</a></li>
		</ul>
	</div>

	<div id="header" class="clearFix">

		<div class="minWidth">
			<h1><a href="index.html"><span>jQuery for Designers</span></a></h1>

			<ul id="filter">
				<li>Filter by</li>
				<!-- <li><a href="/">All</a></li> -->
				<li><a href="tag/easy/index.html">Easy</a></li>
				<li><a href="tag/medium/index.html">Medium</a></li>
				<li><a href="tag/hard/index.html">Hard</a></li>
				<li id="searchLink"><a href="index.html%3Fp=252.html#searchForm">Search</a></li>
			</ul>

		</div>
	</div>
	<!-- END header -->

	<!-- BEGIN titleHolder -->
	<div id="titleHolder" class="clearFix">
		<div class="titleHolderInner">
		<div id="scrollButtons">
			<div class="minWidth clearFix">

        <ul class="clearFix" id="articleStrip">
      <li class="selected"><a title="Enabling the Back Button" href="index.html%3Fp=252.html"><img alt="Enabling the Back Button" src="http://static.jqueryfordesigners.com/images/video/bbq_thumb.gif" /></a><em class="selected">Selected</em></li>
<li><a title="J4D update: My Book, Other Books, Workshops and talks" href="index.html%3Fp=247.html"><img alt="J4D update: My Book, Other Books, Workshops and talks" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Adding Keyboard Navigation" href="index.html%3Fp=231.html"><img alt="Adding Keyboard Navigation" src="http://static.jqueryfordesigners.com/images/video/keyboard-nav-thumb.jpg" /></a></li>
<li><a title="Fixed Floating Elements" href="index.html%3Fp=214.html"><img alt="Fixed Floating Elements" src="http://static.jqueryfordesigners.com/images/video/fixedfloat-thumb.gif" /></a></li>
<li><a title="Want to learn more about JavaScript? Go Full Frontal!" href="index.html%3Fp=199.html"><img alt="Want to learn more about JavaScript? Go Full Frontal!" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="iPhone-like Sliding Headers" href="index.html%3Fp=190.html"><img alt="iPhone-like Sliding Headers" src="images/video/header-slide-thumb.jpg" /></a></li>
<li><a title="Automatic Infinite Carousel" href="index.html%3Fp=158.html"><img alt="Automatic Infinite Carousel" src="images/video/infinite-auto-thumb.jpg" /></a></li>
<li><a title="Play School: Broken Repeating Animations" href="index.html%3Fp=145.html"><img alt="Play School: Broken Repeating Animations" src="images/video/repeat-effect-thumb.png" /></a></li>
<li><a title="API: queue &#038; dequeue" href="index.html%3Fp=135.html"><img alt="API: queue &#038; dequeue" src="images/video/queue-thumb.gif" /></a></li>
<li><a title="jQuery Infinite Carousel" href="index.html%3Fp=128.html"><img alt="jQuery Infinite Carousel" src="images/video/infinite-thumb.jpg" /></a></li>
<li><a title="jQuery for Designers: In Live Action" href="index.html%3Fp=123.html"><img alt="jQuery for Designers: In Live Action" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Return to normal scheduling" href="index.html%3Fp=120.html"><img alt="Return to normal scheduling" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="SlideDown Animation Jump Revisited" href="index.html%3Fp=89.html"><img alt="SlideDown Animation Jump Revisited" src="images/video/animation-jump2-thumb.gif" /></a></li>
<li><a title="BBC Radio 1 Zoom Tabs" href="index.html%3Fp=81.html"><img alt="BBC Radio 1 Zoom Tabs" src="images/video/radio1-thumb.gif" /></a></li>
<li><a title="API: map &#038; grep" href="index.html%3Fp=75.html"><img alt="API: map &#038; grep" src="images/video/mapgrep-thumb.gif" /></a></li>
<li><a title="SXSW, Server Issues and Redesign" href="index.html%3Fp=54.html"><img alt="SXSW, Server Issues and Redesign" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="jQuery look: Tim Van Damme" href="index.html%3Fp=25.html"><img alt="jQuery look: Tim Van Damme" src="images/video/tvd-thumb.jpg" /></a></li>
<li><a title="How to tell if an element exists" href="index.html%3Fp=24.html"><img alt="How to tell if an element exists" src="images/video/element-exists-thumb.jpg" /></a></li>
<li><a title="The Book and The Redesign" href="index.html%3Fp=23.html"><img alt="The Book and The Redesign" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Ajax Spy" href="index.html%3Fp=22.html"><img alt="Ajax Spy" src="images/video/ajax-spy-thumb.jpg" /></a></li>
<li><a title="Play School: Easy Ajax &#8211; load" href="index.html%3Fp=21.html"><img alt="Play School: Easy Ajax &#8211; load" src="images/video/api-load-thumb.jpg" /></a></li>
<li><a title="API: Filter &#038; Find" href="index.html%3Fp=20.html"><img alt="API: Filter &#038; Find" src="images/video/api-filter-find-thumb.jpg" /></a></li>
<li><a title="Simple jQuery Spy Effect" href="index.html%3Fp=19.html"><img alt="Simple jQuery Spy Effect" src="images/video/simple-spy-thumb.jpg" /></a></li>
<li><a title="Fun with Overflows" href="index.html%3Fp=18.html"><img alt="Fun with Overflows" src="images/video/overflows-thumb.jpg" /></a></li>
<li><a title="Two New Series" href="index.html%3Fp=17.html"><img alt="Two New Series" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Animation Jump &#8211; quick tip" href="animation-jump-quick-tip.1.html"><img alt="Animation Jump &#8211; quick tip" src="images/video/animation-jump-thumb.gif" /></a></li>
<li><a title="Image Fade Revisited" href="image-fade-revisited.1.html"><img alt="Image Fade Revisited" src="images/video/image-fade-revisited-thumb.gif" /></a></li>
<li><a title="Coda Slider Effect" href="coda-slider-effect.1.html"><img alt="Coda Slider Effect" src="images/video/coda-slider-thumb.gif" /></a></li>
<li><a title="Help make jQuery for Designers better" href="index.html%3Fp=13.html"><img alt="Help make jQuery for Designers better" src="wp-content/themes/j4d/static/images/titleholder_placeholder.gif" /></a></li>
<li><a title="Image Cross Fade Transition" href="index.html%3Fp=12.html"><img alt="Image Cross Fade Transition" src="images/video/image-fade-thumb.gif" /></a></li>
<li><a title="Coda Popup Bubbles" href="coda-popup-bubbles.1.html"><img alt="Coda Popup Bubbles" src="images/video/coda-bubbles-thumb.gif" /></a></li>
<li><a title="Slider Gallery" href="slider-gallery.1.html"><img alt="Slider Gallery" src="images/video/slider-gallery-thumb.gif" /></a></li>
<li><a title="Image Loading" href="index.html%3Fp=9.html"><img alt="Image Loading" src="images/video/image-loading-thumb.gif" /></a></li>
<li><a title="jQuery Tabs" href="index.html%3Fp=8.html"><img alt="jQuery Tabs" src="images/video/tabs-thumb.gif" /></a></li>
<li><a title="Slide out and drawer effect" href="index.html%3Fp=7.html"><img alt="Slide out and drawer effect" src="images/video/slide-draw-thumb.gif" /></a></li>
<li><a title="Using Ajax to Validate Forms" href="index.html%3Fp=6.html"><img alt="Using Ajax to Validate Forms" src="images/video/validate-thumb.gif" /></a></li>
<li><a title="It&#8217;s all about CSS" href="index.html%3Fp=4.html"><img alt="It&#8217;s all about CSS" src="images/video/css-thumb.gif" /></a></li><li class="new"><a title="Simple use of Event Delegation" href="index.html%3Fp=343.html"><img alt="Simple use of Event Delegation" src="images/video/event-delegation-thumb.gif" /><em>New</em></a></li>
<li><a title="Populate Select Boxes" href="index.html%3Fp=328.html"><img alt="Populate Select Boxes" src="images/video/select-boxes-thumb.gif" /></a></li>
<li><a title="Scroll Linked Navigation" href="index.html%3Fp=309.html"><img alt="Scroll Linked Navigation" src="images/video/scroll-link-nav_thumb.gif" /></a></li>
<li><a title="Debugging Tools" href="index.html%3Fp=290.html"><img alt="Debugging Tools" src="images/video/debuggers_thumb.gif" /></a></li>        </ul>
      </div>

		</div>


		<form id="searchForm" action="index.html">

			<fieldset>

				<legend>Search</legend>

				<label for="search">Search for</label>
				<input type="text" id="search" placeholder="screencasts &amp; tutorials" name="s" value="" /><input class="button" type="submit" value="Find articles" />

			</fieldset>

		</form>

		</div>
	</div>
	<!-- END titleHolder -->

  <!-- content -->
	<div id="content" class="clearFix">
<div class="header">
		<h1><a href="index.html%3Fp=252.html" rel="bookmark">Enabling the Back Button</a></h1>

		<p><span>Posted on 19th April 2010 &mdash;</span> As we build more and more <em>Ajaxy</em> applications, and our apps reside on a single page, the browser&#8217;s native back button can get more and more broken. This episode will show you how to re-enable the back button on your apps.
</p>
    <ul id="articleNav">
      <li class="prev"><a href="index.html%3Fp=247.html" rel="prev">Earlier: <em>J4D update: My Book, Other Books, Workshops and talks</em></a></li>
      <li class="next"><a href="index.html%3Fp=290.html" rel="next">Next: <em>Debugging Tools</em></a></li>
    </ul>
</div>
<div id="carbonads-container"><div class="carbonad"><div id="azcarbon"></div><script type="text/javascript">var z = document.createElement("script"); z.type = "text/javascript"; z.async = true; z.src = "http://engine.carbonads.com/z/12976/azcarbon_2_1_0_HORIZ"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(z, s);</script></div></div>
		<ul class="articleNav clearFix">
			<li class="tabTutorial"><a class="tutorial selected" href="index.html%3Fp=252.html"><span>Tutorial</span></a></li>
						<li class="tabDemo"><a class="demo" href="http://static.jqueryfordesigners.com/demo/back-button.html"><span>Try Demo</span></a></li>			<li class="tabCode"><a class="code" href="index.html%3Fp=252.html"><span>View Code</span></a></li>
			<li class="tabComments"><a class="comments" href="index.html%3Fp=252.html#allcomments"><em>36</em> <span>Comments</span></a></li>
		</ul>

        <div id="article" class="clearFix">

			<div class="copy">

		    <div id="viewport" class="tutorial">
                <div id="tutorial" class="tab">
    				    				  <div id="videoPreview">
      					<ul>
      						<li><a class="quicktime_video" href="media/bbq.mp4"><img alt="QuickTime version" src="wp-content/themes/j4d/static/images/video_quicktime.png"/>Play QuickTime version <span class="download">Right click to download</span></a></li>
      						<li><a class="flash_video" href="media/bbq.mp4"><img alt="Flash version" src="wp-content/themes/j4d/static/images/video_flash.png"/>Play Flash version <span class="download">Right click to download</span></a></li>
      					</ul>
      					<img src="http://static.jqueryfordesigners.com/images/video/bbq.jpg" alt="Enabling the Back Button" />
      				</div>



                <p><span id="more-252"></span></p>

<h2>Watch</h2>

<p><a href="media/bbq.mp4">Watch Enabling the Back Button screencast</a> (<a href="video.php%3Ff=bbq.mp4.html">Alternative flash version</a>)</p>

<p>QuickTime version is approximately 50Mb, flash version is streaming.</p>

<p><a href="http://static.jqueryfordesigners.com/demo/back-button.html">View the demo used in the screencast</a></p>

<h2>The Problem</h2>

<p>Using our original <a href="index.html%3Fp=8.html">jQuery tabs</a> solution, we have a tabbing system that you can click the tabs and different content loads. However, when I hit the back or forward buttons, the web page navigates completely away from the site. </p>

<p>We want to fix this, so that I can navigate the tabs using the browsers native back and forward buttons.</p>

<h2>&#8220;Cowboy&#8221; Ben Alman&#8217;s BBQ</h2>

<p>Ben wrote a jQuery plugin called <a href="http://benalman.com/projects/jquery-bbq-plugin/">BBQ</a>. I knew this was supposed to add support for the back button (BBQ standing for Back Button &amp; Query), so I would rework the existing tab demo to make use of this plugin.</p>

<p>Now, in retrospect, I think that I only need Ben&#8217;s <a href="http://benalman.com/projects/jquery-hashchange-plugin/">hashchange plugin</a> as that&#8217;s all I ended up using in the screencast, but none the less, they&#8217;re both worth checking out.</p>

<p>Now armed with Ben&#8217;s plugin, we&#8217;re going to refactor the tab code so that the back button works.</p>

<h2>Solution</h2>

<p>The way the existing tabs work is as follows:</p>

<ol>
<li>Collect all the tab panels using <code>$('div.tabs > div')</code> and initialise to show the first tab<sup>1</sup></li>
<li>Listen for clicks on the links that form the actual tabs</li>
<li>When a tab is clicked, hide all the tab panels, filter down to the one we wanted to see and show it, then update the classes on the tabs so the current link appears to be focused</li>
<li>Finally, initialise by finding the first tab and triggering a click</li>
</ol>

<p><small>#1. Actually, you don&#8217;t need the subsequent lines after the hide: <code>.filter(':first').show()</code> as the trigger <code>hashchange</code> will handle that for us, but I&#8217;ve left it in place so it matches the screencast.</small></p>

<p>This process was our original code, and most of it needs to stay in place. The change in approach is this: instead of listening for clicks on the tabs, we listen for when the URL in the browser changes.</p>

<p>So we listen for the <code>hashchange</code> event, just like we might listen for a click event:</p>

<pre><code>$(window).bind('hashchange', function () {
  // do some magic
});</code></pre>

<p>Now we move all of the original code from the click handler in to this new event listener. I&#8217;ve copied this code in, and marked in bold which lines we&#8217;ll need to change:</p>

<pre><code>$(window).bind('hashchange', function () {
  tabContainers.hide();
  tabContainers.filter(<strong>this.hash</strong>).show();
  $('div.tabs ul.tabNavigation a').removeClass('selected');
  $(<strong>this</strong>).addClass('selected');
  <strong>return false;</strong>
});</code></pre>

<p>At this point all the references to <code>this</code> need to change, because in our original version <code>this</code> referred to the link that had be clicked. Now we need to determine the link based on the window URL. We can get the newly navigated URL using <code>window.location</code>. This is an object that represents part of the URL, and as such, gives as just the hash by itself: <code>window.location.hash</code>. This is good.</p>

<p>So <code>this</code> is used twice in the code above, once to find the tab panel that we want to show using <code>this.hash</code>. This first one is easy to change. Since the link has been clicked, the address has changed to match the hash of that link, i.e. we clicked on <code>&lt;a href=&quot;#one&quot;&gt;first&lt;/a&gt;</code> so the URL is bbq.html#one. Instead of using <code>this.hash</code> we can use the <code>window.location.hash</code> instead &#8211; they&#8217;ll match exactly.</p>

<p>Next we need to address how we can target the appropriate tab to add the selected class. Since we don&#8217;t have <code>this</code> to target the right tab, we need to <em>find</em> the element using jQuery. Since we have the hash, we can use this to find the tab link. We can use the &#8220;hash&#8221; attribute selector like this:</p>

<pre><code>$('a[hash=#first]')</code></pre>

<p>Therefore we can substitute our hash variable in to the &#8216;#first&#8217; part of the selector above, and now we&#8217;ll have the right element to add the selected class.</p>

<p>Finally in this code, we just have to remove the <code>return false</code> as it&#8217;s not required at all.</p>

<p>Then one last change to make to our code &#8211; we need to trigger the <code>hashchange</code> event, which will cause our code to run.</p>

<h3>jQuery</h3>

<p>Our final code looks like this:</p>

<pre><code>$(function () {
  var tabContainers = $('div.tabs > div');
  tabContainers.hide().filter(':first').show();

  $(window).bind('hashchange', function () {
    var hash = window.location.hash || '#first';

    tabContainers.hide();
    tabContainers.filter(hash).show();
    $('div.tabs ul.tabNavigation a').removeClass('selected');
    $('a[hash=' + hash + ']').addClass('selected');
  });

  $(window).trigger("hashchange");
});</code></pre>

<p>Once last note: if we trigger the <code>hashchange</code> event, and there&#8217;s no hash on the URL, then we need to give it a default. In this case I&#8217;ve given it #first as a default so that it always lands on the first tab if there&#8217;s nothing pre-selected.</p>
                <p class="follow">You should follow me on Twitter <a href="http://twitter.com/rem">here</a> <span class="note">I tweet about jQuery amongst the usual tweet-splurges!</span></p>

